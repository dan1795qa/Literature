function tma__userbar__drawWidget(){var e=document.getElementById("allrecords"),t=document.getElementById("app"),r=tma__getProfileObjFromLS();"function"==typeof tma__addFontStyle&&tma__addFontStyle();var a=tma__userbar__getWidgetUserHtml(r);!t||tildaMembers.objLecture&&"page"===tildaMembers.objLecture.type?e.insertAdjacentHTML("afterend",tma__translate(a,"userbar_dict")):t.insertAdjacentHTML("beforeend",tma__translate(a,"userbar_dict"));var o=document.querySelector(".tlk-userbar"),s=o.querySelector(".tlk-userbar__user"),a=document.getElementById("tlk-userbar-style"),_=o.querySelector(".tlk-userbar__user-image");a||tma__userbar__createUserbarStyles();var l=setInterval(function(){document.getElementById("tlk-loader")||(clearInterval(l),setTimeout(function(){s.classList.add("tlk-userbar__user_scale")},300))},300);tildaMembers.is_get_profile?tma__userbar__addWidgetEvents(o,_,r):_.addEventListener("click",function(){var e,t,r;tildaMembers.is_get_profile||(e=o.querySelector(".tlk-userbar__popup"),t=o.querySelector(".tlk-userbar__popup-wrap"),r=o.querySelector(".tlk-userbar__popup-content"),tma__userbar__showPreloader(_,t,r),tma__getObjProfile(function(){tma__userbar__hidePreloader(o,_,t,r)}),tma__userbar__showWidgetPanel(o,e,t),tma__userbar__calcCoordinatsWidgetPanel(o,e,t))},{once:!0}),tma__userbar__addInputWithUserData()}function tma__userbar__addWidgetEvents(e,t,r){var a,o,s,_;tildaMembers.is_init_userbar_events||(a=e.querySelector(".tlk-userbar__popup"),o=e.querySelector(".tlk-userbar__popup-wrap"),s=e.querySelector(".tlk-userbar__popup-edit-profile"),_=e.querySelector(".tlk-userbar__popup-logout"),tma__onFuncLoad("tma__profile__drawProfilePopup",function(){tma__profile__drawProfilePopup()}),tma__userbar__addAccordionEvents(),t.addEventListener("click",function(){a.classList.contains("tlk-userbar__popup-show")?tma__userbar__closeWidgetPanel(a):tma__userbar__showWidgetPanel(e,a,o)}),s.addEventListener("click",function(){tma__userbar__closeWidgetPanel(a)}),document.addEventListener("click",function(e){e.target.closest(".tlk-userbar")||tma__userbar__closeWidgetPanel(a)}),_.addEventListener("click",function(){var e=JSON.stringify({projectid:r.projectid,token:r.token,tzoffset:(new Date).getTimezoneOffset()});tma__request("/api/logout/",e,"",function(e){var t="tilda_members_profile"+r.projectid;localStorage.removeItem(t),localStorage.removeItem(t+"_timestamp"),document.location.replace("/members/login")})}),tildaMembers.is_init_userbar_events=!0)}function tma__userbar__showWidgetPanel(e,t,r){t.classList.add("tlk-userbar__popup-show"),tma__userbar__calcCoordinatsWidgetPanel(e,t,r)}function tma__userbar__closeWidgetPanel(e){e.classList.remove("tlk-userbar__popup-show"),e.classList.remove("tlk-userbar__popup_bottom"),e.classList.remove("tlk-userbar__popup_left"),e.style.maxHeight=null}function tma__userbar__showPreloader(e,t,r){e.disabled=!0,r.style.opacity=0,t.insertAdjacentHTML("beforeend",tma__userbar__getPreloaderHtml())}function tma__userbar__hidePreloader(e,t,r,a){var o=tma__getProfileObjFromLS(),s=r.querySelector(".tlk-userbar__preloader"),_=tma__userbar__getWidgetPopupContentHtml(o);t.disabled=!1,s.style.opacity=0,a.style.opacity=null,setTimeout(function(){s.remove(),a.insertAdjacentHTML("beforeend",tma__translate(_,"userbar_dict")),tma__userbar__addWidgetEvents(e,t,o)},300)}function tma__userbar__calcCoordinatsWidgetPanel(e,t,r){var a,o=getComputedStyle(e,null),s=+o.top.replace("px",""),_=+o.bottom.replace("px",""),e=+o.left.replace("px",""),_=s<_,e=+o.right.replace("px","")<e;r.style.maxHeight=null,_?(_=window.innerHeight)<(a=t.getBoundingClientRect()).bottom&&(r.style.maxHeight=a.height-(a.bottom-_+10)+"px"):(t.classList.add("tlk-userbar__popup_bottom"),(a=t.getBoundingClientRect()).top<0&&(r.style.maxHeight=a.height-Math.abs(a.top)-10+"px")),e||t.classList.add("tlk-userbar__popup_left")}function tma__userbar__updateDataProfile(){var e=document.querySelector(".tlk-userbar__popup-name"),t=document.querySelector(".tlk-userbar__popup-email"),r=document.querySelector(".tlk-userbar__user-image"),a=tma__getProfileObjFromLS();e.innerHTML=a.name,t.innerHTML=a.login,a.memberlogo_uuid!==tildaMembers.upload.oldId&&(r.innerHTML=tma__userbar__getLogoHtml(a)),a.memberlogo_uuid&&(tildaMembers.upload.id=a.memberlogo_uuid,tildaMembers.upload.oldId=a.memberlogo_uuid)}function tma__userbar__addAccordionEvents(){for(var e=document.querySelectorAll(".tlk-accordion"),t=0;t<e.length;t++){var r=e[t].querySelector(".tlk-accordion__link");r.classList.contains("tlk-accordion__link_not")||r.addEventListener("click",function(){var e=this.nextElementSibling;this.classList.contains("tlk-accordion__action")?(this.classList.remove("tlk-accordion__action"),e.style.maxHeight=null):(this.classList.add("tlk-accordion__action"),e.style.maxHeight=e.scrollHeight+"px")})}}function tma__userbar__getWidgetUserHtml(e){var t="";return t+='<div class="tlk-userbar">',t+='<div class="tlk-userbar__user">',t+='<div class="tlk-userbar__user-notification"></div>',t+='<button class="tlk-userbar__user-image tlk-btn_reset" type="button">',t+=tma__userbar__getLogoHtml(e),t+="</button>",t+="</div>",t+='<div class="tlk-userbar__popup">',t+='<div class="tlk-userbar__popup-wrap">',t+='<div class="tlk-userbar__popup-content">',tildaMembers.is_get_profile&&(t+=tma__userbar__getWidgetPopupContentHtml(e)),t+="</div>",t+="</div>",t+="</div>",t+="</div>"}function tma__userbar__getWidgetPopupContentHtml(e){var t="";if(t+='<div class="tlk-userbar__popup-login">',t+='<div class="tlk-userbar__popup-name">'+e.name+"</div>",t+='<div class="tlk-userbar__popup-email">('+e.login+")</div>",t+='<button type="button" class="tlk-userbar__popup-edit-profile tlk-btn_reset">{{widget_userbar_btn_edit_profile}}</button>',t+='<button type="button" class="tlk-userbar__popup-logout tlk-btn_reset">{{widget_userbar_btn_logout}}</button>',t+="</div>",e.courses&&0<e.courses.length||e.groups&&0<e.groups.length){if(t+='<div class="tlk-userbar__popup-container">',0<e.courses.length){t+='<div class="tlk-userbar__popup-courses">',t+='<div class="tlk-userbar__popup-heading">{{widget_userbar_title_courses}}</div>';for(var r=0;r<e.courses.length;r++)t+=tma__userbar__getCourseItemHtml(e.courses[r]);t+="</div>"}if(0<e.groups.length){t+='<div class="tlk-userbar__popup-groups">',t+='<div class="tlk-userbar__popup-heading">{{widget_userbar_title_groups}}</div>';for(r=0;r<e.groups.length;r++)t+=tma__userbar__getGroupsItemHtml(e.groups[r]);t+="</div>"}t+="</div>"}return t}function tma__userbar__getCourseItemHtml(e){var t="";return t+='<div class="tlk-userbar__popup-courses-item">',t+='<div class="tlk-userbar__popup-title">',t+='<a href="/members/courses/'+e.alias+'" class="tlk-userbar__popup-courses-link" data-field="tlk-link">'+e.name+"</a>",t+="</div>",t+="</div>"}function tma__userbar__getGroupsItemHtml(e){var t="",r=0<e.pages.length&&(!e.homepage||"0"===e.homepage)&&!e.index;if(t+='<div class="tlk-userbar__popup-groups-item'+(r?" tlk-accordion":"")+'">',t+='<div class="tlk-userbar__popup-groups-title'+(r?" tlk-accordion__link":"")+'">',e.homepage&&e.index?(t+='<a href="/'+e.index+'" class="tlk-userbar__popup-groups-link" data-field="tlk-link">',t+=e.name,t+='<svg version="1.1" class="tlk-userbar__popup-groups-link-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100.2 100.2" style="enable-background:new 0 0 100.2 100.2;" xml:space="preserve">',t+="<g>",t+='<path class="st0" d="M83,47.5c-0.8,0-1.5,0.7-1.5,1.5v17.5h-49v-49H50c0.8,0,1.5-0.7,1.5-1.5s-0.7-1.5-1.5-1.5H31 c-0.8,0-1.5,0.7-1.5,1.5v13.5H17c-0.8,0-1.5,0.7-1.5,1.5v52c0,0.8,0.7,1.5,1.5,1.5h52c0.8,0,1.5-0.7,1.5-1.5V69.5H83 c0.8,0,1.5-0.7,1.5-1.5V49C84.5,48.2,83.8,47.5,83,47.5z M67.5,81.5h-49v-49h11V68c0,0.8,0.7,1.5,1.5,1.5h36.5V81.5z" />',t+='<path class="st0" d="M83,14.5H64c-0.8,0-1.5,0.7-1.5,1.5c0,0.8,0.7,1.5,1.5,1.5h15.4L54.9,41.9c-0.6,0.6-0.6,1.5,0,2.1 c0.3,0.3,0.7,0.4,1.1,0.4s0.8-0.1,1.1-0.4l24.4-24.4V35c0,0.8,0.7,1.5,1.5,1.5s1.5-0.7,1.5-1.5V16C84.5,15.2,83.8,14.5,83,14.5z" />',t+="</g>",t+="</svg>",t+="</a>"):t+=e.name,t+=e.expired?"<span> ({{widget_userbar_title_to}} "+tma__getformatDate(e.expired)+")</span>":"",t+="</div>",r){t+='<div class="tlk-userbar__popup-groups-pages tlk-accordion__content">';for(var a=0;a<e.pages.length;a++){var o=e.pages[a];t+='<div class="tlk-userbar__popup-groups-page">',t+='<a href="/'+o.link+'" class="tlk-userbar__popup-link" data-field="tlk-link">',t+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" fill="none" class="tlk-userbar__popup-groups-icon">',t+='<path d="M8.05 1H3C2.44772 1 2 1.44772 2 2V13C2 13.5523 2.44771 14 3 14H12C12.5523 14 13 13.5523 13 13V5.5M8.05 1L13 5.5M8.05 1V4.5C8.05 5.05228 8.49772 5.5 9.05 5.5H13" stroke="black"/>',t+="</svg>",t+=o.title,t+="</a>",t+="</div>"}for(a=0;a<e.docs.length;a++){var s=e.docs[a];t+='<div class="tlk-userbar__popup-groups-page">',t+='<a href="/'+s.link+'" class="tlk-userbar__popup-link" data-field="tlk-link">',t+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" fill="none" class="tlk-userbar__popup-groups-icon">',t+='<path d="M5 8.5H10M5 10.5H10M5 6.5H10M4.5 2H3C2.44772 2 2 2.44772 2 3V13C2 13.5523 2.44771 14 3 14H12C12.5523 14 13 13.5523 13 13V3C13 2.44772 12.5523 2 12 2H10.5M4.5 2V2C4.5 1.44772 4.94772 1 5.5 1H9.5C10.0523 1 10.5 1.44772 10.5 2V2M4.5 2V2.5C4.5 3.05228 4.94772 3.5 5.5 3.5H9.5C10.0523 3.5 10.5 3.05228 10.5 2.5V2" stroke="black"/>',t+="</svg>",t+=s.title,t+="</a>",t+="</div>"}t+="</div>"}return t+="</div>"}function tma__userbar__getLogoHtml(e){var t="";return e.memberlogo?t+='<img src="'+e.memberlogo+'">':(t+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60">',t+="<defs>",t+='<mask x="0" y="0" width="60" height="60">',t+="<g>",t+='<circle cx="30" cy="30" r="30" fill="#fff"></circle>',t+="</g>",t+="</mask>",t+="</defs>",t+="<g>",t+="<g>",t+='<circle cx="30" cy="30" r="30" fill-opacity="0"></circle>',t+="<g>",t+='<path class="cls-4" fill="#000" fill-opacity=".8" d="M0 0h60v60H0z"></path>',t+="</g>",t+="<g >",t+='<path class="cls-5" d="M46.68 43.83c-2-5.8-6.9-9.69-16.63-9.69s-14.58 3.77-16.84 9.69"></path>',t+="</g>",t+="<g>",t+='<circle class="cls-5" cx="30" cy="20.86" r="8.29"></circle>',t+="</g>",t+="</g>",t+="</g>",t+="</svg>"),t}function tma__userbar__getPreloaderHtml(){var e="";e+='<div class="tlk-userbar__preloader">';for(var t=0;t<3;t++){e+='<div class="tlk-userbar__preloader-wrapper">';for(var r=0;r<3;r++)e+='<div class="tlk-userbar__preloader-text"></div>';e+="</div>"}return e+="</div>"}function tma__userbar__createUserbarStyles(){var e=tildaMembers.settingStyles.controlblock,t="";!e||e&&Array.isArray(e)&&!e.length||((e.user_vertical_coordinate_px||e.user_horizontal_coordinate_px)&&(t+=".tlk-userbar {"),-1!==e.user_position.indexOf("top")&&e.user_vertical_coordinate_px?(t+="top: "+e.user_vertical_coordinate_px+"; ",t+="bottom: auto; "):e.user_vertical_coordinate_px&&(t+="bottom: "+e.user_vertical_coordinate_px+"; ",t+="top: auto; "),-1!==e.user_position.indexOf("left")&&e.user_horizontal_coordinate_px?(t+="left: "+e.user_horizontal_coordinate_px+"; ",t+="right: auto; "):e.user_horizontal_coordinate_px&&(t+="right: "+e.user_horizontal_coordinate_px+"; ",t+="left: auto; "),(e.user_vertical_coordinate_px||e.user_horizontal_coordinate_px)&&(t+="}"),(e.border_color||e.border_width_px)&&(t+=" .tlk-userbar__user-image {",t+="border: "+(e.border_width_px||1)+" solid "+(e.border_color||"transparent")+"; ",t+="}"),(e.user_color||e.user_border_color)&&(t+=" .tlk-userbar__user-image .cls-5 {",e.user_color&&(t+="fill: "+e.user_color+"; "),e.user_border_color&&(t+="stroke: "+e.user_border_color+"; "),t+="}"),(e.user_background||e.user_background_opacity)&&(t+=" .tlk-userbar__user-image .cls-4 {",e.user_background&&(t+="fill: "+e.user_background+"; "),e.user_background_opacity&&(t+="fill-opacity: "+ +e.user_background_opacity/100+"; "),t+="}"),(e.user_vertical_coordinate_mobile_px||e.user_horizontal_coordinate_mobile_px)&&(t+=" @media screen and (max-width: 1023px) {",t+=" .tlk-userbar {"),-1!==e.user_position_mobile.indexOf("top")&&e.user_vertical_coordinate_mobile_px?(t+="top: "+e.user_vertical_coordinate_mobile_px+"; ",t+="bottom: auto; "):e.user_vertical_coordinate_mobile_px&&(t+="bottom: "+e.user_vertical_coordinate_mobile_px+"; ",t+="top: auto; "),-1!==e.user_position_mobile.indexOf("left")&&e.user_horizontal_coordinate_mobile_px?(t+="left: "+e.user_horizontal_coordinate_mobile_px+"; ",t+="right: auto; "):e.user_horizontal_coordinate_mobile_px&&(t+="right: "+e.user_horizontal_coordinate_mobile_px+"; ",t+="left: auto; "),(e.user_vertical_coordinate_mobile_px||e.user_horizontal_coordinate_mobile_px)&&(t+="}",t+="}"),document.head.insertAdjacentHTML("beforeend",'<style id="tlk-userbar-style">'+t+"</style>"))}function tma__userbar__addInputWithUserData(){for(var e=tma__getProfileObjFromLS(),t=document.querySelectorAll(".js-form-proccess"),r=0;r<t.length;r++){var a=t[r],o=a.querySelector('input[name="ma_name"]'),s=a.querySelector('input[name="ma_email"]');o||a.insertAdjacentHTML("beforeend",'<input type="hidden" name="ma_name" value="'+e.name+'">'),s||a.insertAdjacentHTML("beforeend",'<input type="hidden" name="ma_email" value="'+e.login+'">')}}
